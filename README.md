SQL queries generated by Eloquent ORM reference

[Get](#get)

[Where](#where)

[Create](#create)

[Update](#update)

[Delete](#delete)

[One to One](#one-to-one)

[One to Many](#one-to-many)

[Many to Many](#many-to-many)

[Aggregate functions](#aggregate-functions)

[Miscellaneous](#miscellaneous)

## Get

`get` (`all`)

<pre lang=php><sub>User::get()</sub></pre>

<pre lang=sql><sub>SELECT * FROM `users`</sub></pre>

| `get` (`all`) with soft deletes on |
|---|
| <pre lang=php><sub>User::get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `users`.`deleted_at` IS NULL</sub></pre> |

| `get` with soft deleted rows |
|---|
| <pre lang=php><sub>User::withTrashed()->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users`</sub></pre> |

| `first` |
|---|
| <pre lang=php><sub>User::first()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` LIMIT 1</sub></pre> |

| `find` |
|---|
| <pre lang=php><sub>User::find(2)</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `users`.`id` = 2 LIMIT 1</sub></pre> |

| `findMany` |
|---|
| <pre lang=php><sub>User::findMany([1, 2, 3])</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `users`.`id` IN (1, 2, 3)</sub></pre> |

| `value` |
|---|
| <pre lang=php><sub>User::where('name', 'John Smith')->value('email')</sub></pre> |
| <pre lang=sql><sub>SELECT `email` FROM `users` WHERE `name` = 'John Smith' LIMIT 1</sub></pre> |

| `paginate` |
|---|
| <pre lang=php><sub>User::paginate()</sub></pre> |
| <pre lang=sql><sub>SELECT COUNT(*) AS aggregate FROM `users`</sub></pre><pre lang=sql><sub>SELECT * FROM `users` LIMIT 15 OFFSET 0</sub></pre> |



## Where

| `where` |
|---|
| <pre lang=php><sub>User::where('age', '>', 32)->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `age` > 32</sub></pre> |

| `orWhere` |
|---|
| <pre lang=php><sub>User::where('age', '>', 40)->orWhere('age', '<', 20)->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `age` > 40 OR `age` < 20</sub></pre> |

| `whereIn` |
|---|
| <pre lang=php><sub>User::whereIn('age', [20, 30, 40])->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `age` IN (20, 30, 40)</sub></pre> |

| `whereBetween` |
|---|
| <pre lang=php><sub>User::whereBetween('age', [20,40])->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `age` BETWEEN 20 AND 40</sub></pre> |

| `whereDate` |
|---|
| <pre lang=php><sub>User::whereDate('created_at', now())->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE DATE(`created_at`) = '2023-10-04'</sub></pre> |



## Create

| `create` |
|---|
| <pre lang=php><sub>User::create(['name' => 'John', 'email' => 'john@smith.com'])</sub></pre> |
| <pre lang=sql><sub>INSERT INTO `users` (`name`, `email`, `updated_at`, `created_at`) VALUES ('John', 'john@smith.com', '2023-10-04 15:30:34', '2023-10-04 15:30:34')</sub></pre> |

| `firstOrCreate` |
|---|
| <pre lang=php><sub>User::firstOrCreate(['email' => 'john@smith.com'], ['name' => 'John'])</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE (`email` = 'john@smith.com') LIMIT 1</sub></pre><pre lang=sql><sub>INSERT INTO `users` (`email`, `name`, `updated_at`, `created_at`) values ('john@smith.com', 'John', '2023-10-04 16:17:59', '2023-10-04 16:17:59')</sub></pre> |



## Update

| `UPDATE` |
|---|
| <pre lang=php><sub>User::where('status', 'some_status')->update(['type' => 'some_type'])</sub></pre> |
| <pre lang=sql><sub>UPDATE `users` SET `type` = 'some_type', `users`.`updated_at` = '2023-10-04 15:36:44' WHERE `status` = 'some_status'</sub></pre> |

| Update single row |
|---|
| <pre lang=php><sub>$user->update(['name' => 'John', 'email' => 'john@smith.com'])</sub></pre> |
| <pre lang=sql><sub>UPDATE `users` SET `name` = 'John', `users`.`updated_at` = '2023-10-04 16:12:30' WHERE `id` = 1</sub></pre> |

| `updateOrCreate` |
|---|
| <pre lang=php><sub>User::updateOrCreate(['email' => 'john@smith.com'], ['name' => 'James']);</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE (`email` = 'john@smith.com') LIMIT 1</sub></pre><pre lang=sql><sub>UPDATE `users` SET `name` = 'James', `users`.`updated_at` = '2023-10-04 16:14:18' WHERE `id` = 1</sub></pre> |



## Delete

| `delete` |
|---|
| <pre lang=php><sub>User::where('status', 'some_status')->delete()</sub></pre> |
| <pre lang=sql><sub>DELETE FROM `users` WHERE `status` = 'some_status'</sub></pre> |

| Delete with soft deletes on |
|---|
| <pre lang=php><sub>User::where('status', 'some_status')->delete()</sub></pre> |
| <pre lang=sql><sub>UPDATE `users` SET `deleted_at` = '2023-10-25 12:58:26', `users`.`updated_at` = '2023-10-25 12:58:26' WHERE `status` = 'some_status' AND `users`.`deleted_at` IS NULL</sub></pre> |

| Delete single row |
|---|
| <pre lang=php><sub>$user->delete()</sub></pre> |
| <pre lang=sql><sub>DELETE FROM `users` WHERE `id` = 1</sub></pre> |

| Delete single row with soft deletes on |
|---|
| <pre lang=php><sub>$user->delete()</sub></pre> |
| <pre lang=sql><sub>UPDATE `users` SET `deleted_at` = '2023-10-25 12:59:52', `users`.`updated_at` = '2023-10-25 12:59:52' WHERE `id` = 1</sub></pre> |

| `destroy` |
|---|
| <pre lang=php><sub>User::destroy(1, 2, 3)</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `id` IN (1, 2, 3)</sub></pre><pre lang=sql><sub>DELETE FROM `users` WHERE `id` = 1</sub></pre><pre lang=sql><sub>DELETE FROM `users` WHERE `id` = 2</sub></pre><pre lang=sql><sub>DELETE FROM `users` WHERE `id` = 3</sub></pre> |

| Destroy with soft deletes on |
|---|
| <pre lang=php><sub>User::destroy(1, 2, 3)</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `id` IN (1, 2, 3) AND `users`.`deleted_at` IS NULL</sub></pre><pre lang=sql><sub>UPDATE `users` SET `deleted_at` = '2023-10-25 12:54:53', `users`.`updated_at` = '2023-10-25 12:54:53' WHERE `id` = 1</sub></pre><pre lang=sql><sub>UPDATE `users` SET `deleted_at` = '2023-10-25 12:54:53', `users`.`updated_at` = '2023-10-25 12:54:53' WHERE `id` = 2</sub></pre><pre lang=sql><sub>UPDATE `users` SET `deleted_at` = '2023-10-25 12:54:53', `users`.`updated_at` = '2023-10-25 12:54:53' WHERE `id` = 3</sub></pre> |

| Restore soft deleted row |
|---|
| <pre lang=php><sub>$user->restore()</sub></pre> |
| <pre lang=sql><sub>UPDATE `users` SET `deleted_at` = '', `users`.`updated_at` = '2023-10-25 13:07:24' WHERE `id` = 1</sub></pre> |



## One to One

`profiles` table has `id`, `user_id`, `city`

User `hasOne` profile, profile `belongsTo` user

For nested relationships examples another one to one relationship is used. Profile `hasOne` passport, passport `belongsTo` profile

| Get user's profile |
|---|
| <pre lang=php><sub>$user->profile</sub></pre> or <pre lang=php><sub>$user->profile()->first()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `profiles` WHERE `profiles`.`user_id` = 2 AND `profiles`.`user_id` IS NOT NULL LIMIT 1</sub></pre> |

| Get user with profile |
|---|
| <pre lang=php><sub>User::with('profile')->find(2)</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `users`.`id` = 2 LIMIT 1</sub></pre><pre lang=sql><sub>SELECT * FROM `profiles` WHERE `profiles`.`user_id` IN (2)</sub></pre> |

| Get user's passport (nested one to one relationships) |
|---|
| <pre lang=php><sub>$user->profile->passport</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `users`.`id` = 2 LIMIT 1</sub></pre><pre lang=sql><sub>SELECT * FROM `profiles` WHERE `profiles`.`user_id` = 2 AND `profiles`.`user_id` IS NOT NULL LIMIT 1</sub></pre><pre lang=sql><sub>SELECT * FROM `passports` WHERE `passports`.`profile_id` = 4 AND `passports`.`profile_id` IS NOT NULL LIMIT 1</sub></pre> |

| Get user with profile AND passport (nested one to one relationships) |
|---|
| <pre lang=php><sub>User::with('profile.passport')->find(2)</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE `users`.`id` = 2 LIMIT 1</sub></pre><pre lang=sql><sub>SELECT * FROM `profiles` WHERE `profiles`.`user_id` IN (2)</sub></pre><pre lang=sql><sub>SELECT * FROM `passports` WHERE `passports`.`profile_id` IN (4)</sub></pre> |

| Get users who have profiles |
|---|
| <pre lang=php><sub>User::has('profile')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `profiles` WHERE `users`.`id` = `profiles`.`user_id`)</sub></pre> |

| Get users who have passport (nested one to one relationships) |
|---|
| <pre lang=php><sub>User::has('profile.passport')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `profiles` WHERE `users`.`id` = `profiles`.`user_id` AND EXISTS (SELECT * FROM `passports` WHERE `profiles`.`id` = `passports`.`profile_id`))</sub></pre> |

| Get users from Adelaide |
|---|
| <pre lang=php><sub>User::whereHas('profile', function ($q) { $q->where('city', 'Adelaide'); })->get();</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `profiles` WHERE `users`.`id` = `profiles`.`user_id` AND `city` = 'Adelaide')</sub></pre> |

| Get users who have profiles and load their profiles |
|---|
| <pre lang=php><sub>User::has('profile')->with('profile')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `profiles` WHERE `users`.`id` = `profiles`.`user_id`)</sub></pre><pre lang=sql><sub>SELECT * FROM `profiles` WHERE `profiles`.`user_id` IN (1, 2, 3)</sub></pre> |



## One to Many

`orders` table has `id`, `user_id`, `comment`

User has many orders. Order `belongsTo` user

For nested relationships examples another one to many relationship is used. Order `hasMany` support tickets, support ticket `belongsTo` order.

| Get user's orders |
|---|
| <pre lang=php><sub>$user->orders or $user->orders()->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `orders` WHERE `orders`.`user_id` = 1 AND `orders`.`user_id` IS NOT NULL</sub></pre> |

| Get users with orders |
|---|
| <pre lang=php><sub>User::with('orders')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users`</sub></pre><pre lang=sql><sub>SELECT * FROM `orders` WHERE `orders`.`user_id` IN (1, 2, 3)</sub></pre> |

| Get users with orders and support tickets (nested one to many relationships) |
|---|
| <pre lang=php><sub>User::with('orders.supportTickets')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users`</sub></pre><pre lang=sql><sub>SELECT * FROM `orders` WHERE `orders`.`user_id` IN (1, 2, 3)</sub></pre><pre lang=sql><sub>SELECT * FROM `support_tickets` WHERE `support_tickets`.`order_id` IN (7, 8, 9)</sub></pre> |

| Load companies for user |
|---|
| <pre lang=php><sub>$user->load('orders')</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `orders` WHERE `orders`.`user_id` IN (1)</sub></pre> |

| Get users who have orders |
|---|
| <pre lang=php><sub>User::has('orders')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `orders` WHERE `users`.`id` = `orders`.`user_id`)</sub></pre> |

| Get users who have support tickets (nested one to many relationships) |
|---|
| <pre lang=php><sub>User::has('orders.supportTickets')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `orders` WHERE `users`.`id` = `orders`.`user_id` AND EXISTS (SELECT * FROM `support_tickets` WHERE `orders`.`id` = `support_tickets`.`order_id`))</sub></pre> |

| Get users who has orders with empty comment |
|---|
| <pre lang=php><sub>User::whereHas('orders', function ($q) { $q->WHERENull('comment'); })->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `orders` WHERE `users`.`id` = `orders`.`user_id` AND `comment` IS NULL)</sub></pre> |

| Get users who have orders and load their orders |
|---|
| <pre lang=php><sub>User::has('orders')->with('orders')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `orders` WHERE `users`.`id` = `orders`.`user_id`)</sub></pre><pre lang=sql><sub>SELECT * FROM `orders` WHERE `orders`.`user_id` IN (1, 2, 3)</sub></pre> |



## Many to Many

`companies` table has `id`, `name`

`company_user` is a pivot table, it has `company_id`, `user_id` columns

User `belongsToMany` companies, company `belongsToMany` users

For nested relationships examples another many to many relationship is used. Company `belongsToMany` employees, employee `belongsToMany` companies

| Get user's companies |
|---|
| <pre lang=php><sub>$user->companies</sub></pre> or <pre lang=php><sub>user->companies()->get()</sub></pre> |
| <pre lang=sql><sub>SELECT `companies`.*, `company_user`.`user_id` AS `pivot_user_id`, `company_user`.`company_id` AS `pivot_company_id` FROM `companies` INNER JOIN `company_user` ON `companies`.`id` = `company_user`.`company_id` WHERE `company_user`.`user_id` = 1</sub></pre> |

| Get users with companies |
|---|
| <pre lang=php><sub>User::with('companies')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT `companies`.*, `company_user`.`user_id` AS `pivot_user_id`, `company_user`.`company_id` AS `pivot_company_id` FROM `companies` INNER JOIN `company_user` ON `companies`.`id` = `company_user`.`company_id` WHERE `company_user`.`user_id` IN (1, 2, 3)</sub></pre> |

| Get users with employees (nested many to many relationships) |
|---|
| <pre lang=php><sub>User::with('companies.employees')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users`</sub></pre><pre lang=sql><sub>SELECT `companies`.*, `company_user`.`user_id` AS `pivot_user_id`, `company_user`.`company_id` AS `pivot_company_id` FROM `companies` INNER JOIN `company_user` ON `companies`.`id` = `company_user`.`company_id` WHERE `company_user`.`user_id` IN (1, 2, 3)</sub></pre><pre lang=sql><sub>SELECT `employees`.*, `company_employee`.`company_id` AS `pivot_company_id`, `company_employee`.`employee_id` AS `pivot_employee_id` FROM `employees` INNER JOIN `company_employee` ON `employees`.`id` = `company_employee`.`employee_id` WHERE `company_employee`.`company_id` IN (7, 8, 9)</sub></pre> |

| Load companies for user |
|---|
| <pre lang=php><sub>$user->load('companies')</sub></pre> |
| <pre lang=sql><sub>SELECT `companies`.*, `company_user`.`user_id` AS `pivot_user_id`, `company_user`.`company_id` AS `pivot_company_id` FROM `companies` INNER JOIN `company_user` ON `companies`.`id` = `company_user`.`company_id` WHERE `company_user`.`user_id` IN (1)</sub></pre> |

| Load companies AND employees for user (nested many to many relationships) |
|---|
| <pre lang=php><sub>$user->load('companies. employees')</sub></pre> |
| <pre lang=sql><sub>SELECT `companies`.*, `company_user`.`user_id` AS `pivot_user_id`, `company_user`.`company_id` AS `pivot_company_id` FROM `companies` INNER JOIN `company_user` ON `companies`.`id` = `company_user`.`company_id` WHERE `company_user`.`user_id` IN (2)</sub></pre><pre lang=sql><sub>SELECT `employees`.*, `company_employee`.`company_id` AS `pivot_company_id`, `company_employee`.`employee_id` AS `pivot_employee_id` FROM `employees` INNER JOIN `company_employee` ON `employees`.`id` = `company_employee`.`employee_id` WHERE `company_employee`.`company_id` IN (7, 8, 9)</sub></pre> |

| Get users who have companies |
|---|
| <pre lang=php><sub>User::has('companies')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `companies` INNER JOIN `company_user` ON `companies`.`id` = `company_user`.`company_id` WHERE `users`.`id` = `company_user`.`user_id`)</sub></pre> |

| Get users who have companies with employees (nested many to many relationships) |
|---|
| <pre lang=php><sub>User::has('companies.employees')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `companies` INNER JOIN `company_user` ON `companies`.`id` = `company_user`.`company_id` WHERE `users`.`id` = `company_user`.`user_id` AND EXISTS (SELECT * FROM `employees` INNER JOIN `company_employee` ON `employees`.`id` = `company_employee`.`employee_id` WHERE `companies`.`id` = `company_employee`.`company_id`))</sub></pre> |

| Get users who have companies with empty description |
|---|
| <pre lang=php><sub>User::whereHas('companies', function ($q) { $q->whereNull('description'); })->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `companies` INNER JOIN `company_user` ON `companies`.`id` = `company_user`.`company_id` WHERE `users`.`id` = `company_user`.`user_id` AND `description` IS NULL)</sub></pre> |

| Get users who have companies and load their companies |
|---|
| <pre lang=php><sub>User::has('orders')->with('orders')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` WHERE EXISTS (SELECT * FROM `orders` WHERE `users`.`id` = `orders`.`user_id`)</sub></pre><pre lang=sql><sub>SELECT * FROM `orders` WHERE `orders`.`user_id` IN (1, 2, 3)</sub></pre> |



## Aggregate functions

| `count` |
|---|
| <pre lang=php><sub>User::count()</sub></pre> |
| <pre lang=sql><sub>SELECT COUNT(*) AS aggregate FROM `users`</sub></pre> |

| `max` (`min`, `avg`, `sum`) |
|---|
| <pre lang=php><sub>User::max('age')</sub></pre> |
| <pre lang=sql><sub>SELECT MAX(`age`) AS aggregate FROM `users`</sub></pre> |

| `withSum` (`withAvg`, `withMin`, `withMax`, `withCount`) |
|---|
| <pre lang=php><sub>User::withSum('orders', 'total')->get();</sub></pre> |
| <pre lang=sql><sub>SELECT `users`.*, (SELECT SUM(`orders`.`total`) FROM `orders` WHERE `users`.`id` = `orders`.`user_id`) AS `orders_sum_total` FROM `users`</sub></pre> |



## Miscellaneous

| `latest` (`oldest``) |
|---|
| <pre lang=php><sub>User::latest()->get()</sub></pre> |
| <pre lang=sql><sub>SELECT * FROM `users` ORDER BY `created_at` desc</sub></pre> |

| `withExists` |
|---|
| <pre lang=php><sub>User::withExists('orders')->get()</sub></pre> |
| <pre lang=sql><sub>SELECT `users`.*, EXISTS(SELECT * FROM `orders` WHERE `users`.`id` = `orders`.`user_id`) AS `orders_exists` FROM `users`</sub></pre> |

| `increment` (`decrement`) |
|---|
| <pre lang=php><sub>User::where('id', 2)->increment('bonus', 12)</sub></pre> |
| <pre lang=sql><sub>UPDATE `users` SET `bonus` = `bonus` + 12, `users`.`updated_at` = '2023-10-25 14:58:10' WHERE `id` = 2</sub></pre> |
